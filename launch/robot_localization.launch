<?xml version="1.0"?>

<!-- DON'T LAUNCH THIS FILE DIRECTLY IT IS STARTED BY localisation.launch -->

<launch>
  <!-- <arg name="heading_topic"     default="gps/heading"/> -->
  <arg name="imu_topic"         default="imu/data"/>
  <arg name="odom_topic"        default="/odom"/>
  <arg name="namespace"         default="/"/>
  <arg name="continuous"        default="true"/>
  <arg name="transform_timeout" default="0.5"/>

  <!-- Launch into Namespace -->
  <group ns="$(arg namespace)">

   <!-- Robot Localization Continuous -->
    <node if="$(arg continuous)" name="RobotLocalizationCts" pkg="robot_localization" type="ekf_localization_node" respawn="true" output="log">
      <param name="frequency"                    value="100.0"/>
      <param name="print_diagnostics"            value="false"/>
      <param name="silent_tf_failure"            value="true"/>
      <param name="permit_corrected_publication" value="false"/>
      <param name="sensor_timeout"               value="0.25"/>
      <param name="two_d_mode"                   value="false"/>
      <param name="publish_tf"                   value="true"/>
      <param name="publish_acceleration"         value="false"/>
      <param name="map_frame"                    value="map"/>
      <param name="odom_frame"                   value="odom"/>
      <param name="base_link_frame"              value="base_link"/>
      <param name="world_frame"                  value="odom"/>
      <param name="smooth_lagged_data"           value="true"/>
      <param name="history_length"               value="1.0"/>
      <param name="transform_timeout"            value="$(arg transform_timeout)"/>
      <remap from="set_pose"             to="robot_localization_cts/set_pose"/>
      <remap from="odometry/filtered"    to="robot_localization_cts/odom"/>

      <param name="odom0"                value="$(arg odom_topic)"/>
      <rosparam param="odom0_config">[ true,  true,  true,
                                       true,  true,  true,
                                      false, false, false,
                                      false, false, false,
                                      false, false, false]</rosparam>
      <param name="odom0_differential"   value="false"/>
      <param name="odom0_relative"       value="false"/>
      <param name="odom0_queue_size"     value="10"/>

      <param name="imu0"                 value="$(arg imu_topic)"/>
      <rosparam param="imu0_config">[ true,  true,  true,
                                     false, false, false,
                                     false, false, false,
                                      true,  true,  true,
                                      true,  true,  true]</rosparam>
      <param name="imu0_differential"                      value="false"/>
      <param name="imu0_relative"                          value="true"/>
      <param name="imu0_remove_gravitational_acceleration" value="true"/>
      <param name="imu0_queue_size"                        value="10"/>

      <rosparam param="process_noise_covariance">
      [0.05,    0,    0,    0,    0,    0,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0, 0.05,    0,    0,    0,    0,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0, 0.06,    0,    0,    0,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0, 0.03,    0,    0,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0, 0.03,    0,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0, 0.06,     0,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0, 0.025,     0,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0, 0.025,    0,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0, 0.04,    0,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0, 0.01,    0,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0,    0, 0.01,    0,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0,    0,    0, 0.02,    0,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0,    0,    0,    0, 0.01,    0,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0,    0,    0,    0,    0, 0.01,     0,
          0,    0,    0,    0,    0,    0,     0,     0,    0,    0,    0,    0,    0,    0, 0.015]
      </rosparam>
      <rosparam param="initial_estimate_covariance">
      [1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9,    0,
          0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0,    0, 1e-9]
       </rosparam>
    </node>

    <!-- <node pkg="rosservice" type="rosservice" name="quiet_robot_localization" 
          args="call RobotLocalizationAll/set_logger_level '{logger: ros, level: ERROR}'" /> -->

  </group>

</launch>

